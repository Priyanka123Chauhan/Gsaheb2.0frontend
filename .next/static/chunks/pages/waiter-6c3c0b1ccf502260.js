(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{8186:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/waiter",function(){return a(4642)}])},9292:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var r=a(5893),s=a(7294),l=a(9959),n=a(2424),i=a(6979),o=a(3681),d=a(3903);function c(e){let{cart:t,setCart:a,onPlaceOrder:c,onClose:m,isOpen:u,tableNumber:b,orderNote:h,isEditing:g,menu:x}=e,[p,f]=(0,s.useState)(u),[y,N]=(0,s.useState)(!1),[j,w]=(0,s.useState)(t.reduce((e,t)=>(e[t.item_id]=t.note||"",e),{})),[v,C]=(0,s.useState)(""),[_,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{console.log("BottomCart props:",{isEditing:g,menuLength:null==x?void 0:x.length,searchTerm:v,selectedItem:_,isOpen:u,cartLength:t.length})},[g,x,v,_,u,t]),(0,s.useEffect)(()=>{u?(f(!0),N(!1)):(N(!1),setTimeout(()=>f(!1),300))},[u]),(0,s.useEffect)(()=>{w(e=>{let a={...e};return t.forEach(e=>{e.item_id in a||(a[e.item_id]=e.note||"")}),a})},[t]);let k=(e,t)=>{a(a=>{let r=[...a],s=r.findIndex(t=>t.item_id===e);if(-1===s)return a;let l=(r[s].quantity||1)+t;return l<=0?r.filter((e,t)=>t!==s):(r[s]={...r[s],quantity:l},r)})},T=e=>{a(t=>t.filter(t=>t.item_id!==e)),w(t=>{let a={...t};return delete a[e],a})},O=(e,t)=>{w(a=>({...a,[e]:t})),a(a=>a.map(a=>a.item_id===e?{...a,note:t}:a))},E=x?x.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())):[],q=t.reduce((e,t)=>e+t.price*(t.quantity||1),0),I=t.reduce((e,t)=>e+(t.quantity||1),0);return(0,r.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-white shadow-lg rounded-t-2xl transition-transform duration-300 ease-in-out z-50 ".concat(p?y?"translate-y-[calc(100%-3rem)]":"translate-y-0":"translate-y-full"," ").concat(y?"h-12":"max-h-[80vh]"," flex flex-col overflow-hidden"),role:"dialog","aria-modal":"true","aria-label":"Cart contents",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold",children:[g?"Edit Order":"Cart"," - Table ",b||"Not set"]}),I>0&&(0,r.jsxs)("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:[I," ",1===I?"item":"items"]})]}),(0,r.jsx)("button",{className:"text-gray-600 hover:text-gray-800",onClick:t.length>0?()=>{N(!y)}:m,"aria-label":y?"Maximize cart":"Minimize cart",children:t.length>0&&y?(0,r.jsx)(l.Z,{className:"h-6 w-6"}):(0,r.jsx)(n.Z,{className:"h-6 w-6"})})]}),!y&&(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[0===t.length?(0,r.jsx)("p",{className:"text-center text-gray-500",children:"Cart is empty"}):t.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("img",{src:e.image_url||"https://images.unsplash.com/photo-1550547660-d9450f859349",alt:e.name,className:"w-16 h-16 object-cover rounded"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.category}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:["₹",(e.price*(e.quantity||1)).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"p-1 bg-gray-200 rounded hover:bg-gray-300",onClick:()=>k(e.item_id,-1),"aria-label":"Decrease quantity of ".concat(e.name),children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})}),(0,r.jsx)("span",{className:"w-8 text-center",children:e.quantity||1}),(0,r.jsx)("button",{className:"p-1 bg-gray-200 rounded hover:bg-gray-300",onClick:()=>k(e.item_id,1),"aria-label":"Increase quantity of ".concat(e.name),children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{className:"p-1 bg-red-100 rounded hover:bg-red-200",onClick:()=>T(e.item_id),"aria-label":"Remove ".concat(e.name," from cart"),children:(0,r.jsx)(d.Z,{className:"h-4 w-4 text-red-600"})})]})]}),(0,r.jsx)("input",{type:"text",value:j[e.item_id]||"",onChange:t=>O(e.item_id,t.target.value),className:"mt-2 w-full p-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Item note (e.g., No cheese)"})]},"".concat(e.item_id,"-").concat(t))),g&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("label",{htmlFor:"item-search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Add New Item"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",id:"item-search",value:v,onChange:e=>{console.log("Search input changed:",{value:e.target.value,filteredItems:E.length}),C(e.target.value),S(null)},className:"w-full p-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Search menu items..."}),v&&E.length>0&&(0,r.jsx)("ul",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mb-1 max-h-40 overflow-y-auto shadow-lg bottom-full",children:E.map(e=>(0,r.jsxs)("li",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{console.log("Dropdown item clicked:",e),S(e),C(e.name)},children:[e.name," - ₹",e.price.toFixed(2)]},e.id))}),v&&0===E.length&&(0,r.jsx)("p",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mb-1 p-2 text-gray-500",children:"No matching items found"})]}),(0,r.jsx)("button",{onClick:()=>{console.log("addItemToCart called:",{selectedItem:_,searchTerm:v}),_&&(a(e=>e.find(e=>e.item_id===_.id)?e.map(e=>e.item_id===_.id?{...e,quantity:(e.quantity||1)+1}:e):[...e,{item_id:_.id,name:_.name,price:_.price,category:_.category,image_url:_.image_url||"",quantity:1,note:""}]),C(""),S(null))},disabled:!_,className:"mt-2 w-full py-2 rounded-lg text-white font-medium ".concat(_?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 cursor-not-allowed"),children:"Add Item"})]})]}),!y&&t.length>0&&(0,r.jsxs)("div",{className:"p-4 border-t",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Total:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["₹",q.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600",onClick:m,"aria-label":"Close cart",children:"Close"}),(0,r.jsx)("button",{className:"flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600",onClick:c,"aria-label":g?"Save Order Changes":"Place Order",children:g?"Save Order Changes":"Place Order"})]})]})]})}},4642:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var r=a(5893),s=a(7294),l=a(1535),n=a(9292),i=a(8939),o=a(8317),d=a(4678);let c=e=>fetch(e).then(e=>e.json());function m(){let[e,t]=(0,s.useState)("take-order"),[a,m]=(0,s.useState)(""),[u,b]=(0,s.useState)([]),[h,g]=(0,s.useState)(""),[x,p]=(0,s.useState)(""),[f,y]=(0,s.useState)("All"),[N,j]=(0,s.useState)(!1),[w,v]=(0,s.useState)(null),[C,_]=(0,s.useState)({}),[S,k]=(0,s.useState)([]),[T,O]=(0,s.useState)(""),[E,q]=(0,s.useState)(null),I=e=>{let t=new Date(e),a=(0,o.I)(t,{hours:5,minutes:30});return(0,d.WU)(a,"dd/MM/yyyy, hh:mm a")},P="https://backend-valtri.onrender.com/".replace(/\/+$/,""),{data:F,error:A,isLoading:Z}=(0,l.ZP)("".concat(P,"/api/menu"),c),{data:L,error:M,isLoading:z,mutate:D}=(0,l.ZP)("".concat(P,"/api/orders?status=pending"),c);(0,s.useEffect)(()=>{L&&k(L),M&&(console.error("Pending orders fetch error:",M),"pending-orders"===e&&v("Failed to load pending orders. Please try again later."))},[L,M,e]),(0,s.useEffect)(()=>{A&&v("Failed to load menu. Please try again.")},[A]);let H=["All",...new Set(null==F?void 0:F.map(e=>e.category).filter(Boolean))],W=F?F.filter(e=>"All"===f||e.category===f).filter(e=>e.name.toLowerCase().includes(x.toLowerCase())):[],B=e=>{_(t=>({...t,[e.id]:!0})),setTimeout(()=>{_(t=>({...t,[e.id]:!1}))},1e3),b(t=>t.find(t=>t.item_id===e.id)?t.map(t=>t.item_id===e.id?{...t,quantity:(t.quantity||1)+1}:t):[...t,{item_id:e.id,name:e.name,price:e.price,category:e.category,image_url:e.image_url,quantity:1}]),j(!0)},G=async()=>{if(!a)return v("Please enter a table number.");if(1>parseInt(a)||parseInt(a)>30)return v("Table number must be between 1 and 30.");if(0===u.length)return v("Cart is empty.");let e=0;for(;e<3;)try{v(null);let e=await fetch("".concat(P,"/api/orders"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_id:parseInt(a),items:u,notes:h||null}),signal:AbortSignal.timeout(3e4)}),t=await e.json();if(!e.ok||!t.id)throw Error(t.error||"HTTP ".concat(e.status));b([]),m(""),g(""),j(!1),v("Order placed successfully!"),D();return}catch(t){if(3==++e){v("Failed to place order after ".concat(3," attempts: ").concat(t.message));return}await new Promise(e=>setTimeout(e,1e3))}},J=e=>{if(console.log("startEditingOrder called with order:",e),!e||!e.id||!e.items||!e.table_id){console.error("Invalid order data:",e),v("Cannot edit order: Invalid order data.");return}q({orderId:e.id,tableNumber:e.table_id,items:e.items,notes:e.notes||""}),b(e.items),m(e.table_id.toString()),g(e.notes||""),j(!0),t("pending-orders"),console.log("State after setting:",{editingOrder:{orderId:e.id,tableNumber:e.table_id,items:e.items,notes:e.notes||""},cart:e.items,tableNumber:e.table_id.toString(),orderNote:e.notes||"",isCartOpen:!0,activeTab:"pending-orders"})},R=async()=>{if(!E)return;if(0===u.length)return v("Cart is empty.");let e=0;for(;e<3;)try{v(null);let e=await fetch("".concat(P,"/api/orders/").concat(E.orderId),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:u,notes:h||null}),signal:AbortSignal.timeout(3e4)}),t=await e.json();if(!e.ok||!t.id)throw Error(t.error||"HTTP ".concat(e.status));b([]),m(""),g(""),j(!1),q(null),v("Order updated successfully!"),D();return}catch(t){if(3==++e){v("Failed to update order after ".concat(3," attempts: ").concat(t.message));return}await new Promise(e=>setTimeout(e,1e3))}},X=T?S.filter(e=>e.table_id.toString()===T):S;return Z&&z?(0,r.jsx)("div",{className:"text-center mt-10",role:"status",children:"Loading..."}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex items-center items-center gap-2 mb",children:[(0,r.jsx)(i.Z,{className:"h-6 w-6 text-blue-500"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800","aria-label":"Waiter Interface for Gsaheb Cafe",children:"Waiter Interface - Gsaheb Cafe"}),(0,r.jsx)(i.Z,{className:"h-6 w-6 text-blue-500"})]}),(0,r.jsxs)("div",{className:"flex mb-6",children:[(0,r.jsx)("button",{className:"flex-1 py-2 px-4 rounded-l-lg ".concat("take-order"===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),onClick:()=>t("take-order"),children:"Take Order"}),(0,r.jsx)("button",{className:"flex-1 py-2 px-4 rounded-r-lg ".concat("pending-orders"===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),onClick:()=>t("pending-orders"),children:"Pending Orders"})]}),w&&(0,r.jsxs)("div",{className:"mb-4 flex flex-col items-center justify-center",role:"alert",children:[(0,r.jsx)("p",{className:"text-center ".concat(w.includes("successfully")?"text-green-500":"text-red-500"),children:w}),w.includes("successfully")&&(0,r.jsx)("button",{className:"mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:()=>{window.location.reload()},children:"Refresh"})]}),"take-order"===e&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"table-number",className:"block text-sm font-semibold text-gray-800 mb-2",children:"Table Number (1–30)"}),(0,r.jsx)("input",{type:"number",id:"table-number",value:a,onChange:e=>m(e.target.value),className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-800 placeholder-gray-400",placeholder:"Enter table number (1–30)",min:"1",max:"30",required:!0})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"search-bar",className:"block text-sm font-semibold text-gray-800 mb-2",children:"Search Menu"}),(0,r.jsx)("input",{type:"text",id:"search-bar",value:x,onChange:e=>p(e.target.value),className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-800 placeholder-gray-400",placeholder:"Search for menu items..."})]}),(0,r.jsx)("div",{className:"mb-6 overflow-x-auto whitespace-nowrap pb-2",role:"tablist","aria-label":"Menu categories",children:(0,r.jsx)("div",{className:"flex gap-2",children:H.map(e=>(0,r.jsx)("button",{className:"px-4 py-2 rounded-lg text-sm font-medium ".concat(f===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>y(e),role:"tab","aria-selected":f===e,children:e},e))})}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",role:"region","aria-live":"polite",children:0===W.length?(0,r.jsx)("p",{className:"col-span-full text-center text-gray-500",children:"No items found."}):W.map(e=>(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow",children:[(0,r.jsx)("img",{src:e.image_url||"https://images.unsplash.com/photo-1550547660-d9450f859349",alt:e.name,className:"w-full h-32 object-cover rounded-md mb-2"}),(0,r.jsx)("h2",{className:"font-semibold text-lg",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.category}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:["₹",e.price.toFixed(2)]}),(0,r.jsx)("button",{className:"mt-2 w-full py-2 rounded-lg text-white transition-colors duration-300 ".concat(C[e.id]?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"),onClick:()=>B(e),"aria-label":C[e.id]?"".concat(e.name," added to cart"):"Add ".concat(e.name," to cart"),children:C[e.id]?"Added":"Add to Cart"})]},e.id))}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("label",{htmlFor:"order-note",className:"block text-sm font-semibold text-gray-800 mb-2",children:"Order Note (Optional)"}),(0,r.jsx)("textarea",{id:"order-note",value:h,onChange:e=>g(e.target.value),className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-800 placeholder-gray-400",placeholder:"E.g., No onions, extra spicy",rows:"3"})]})]}),"pending-orders"===e&&(0,r.jsx)("div",{children:z?(0,r.jsx)("div",{className:"text-center mt-10",role:"status",children:"Loading pending orders..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"filter-table-number",className:"block text-sm font-semibold text-gray-800 mb-2",children:"Filter by Table Number"}),(0,r.jsx)("input",{type:"number",id:"filter-table-number",value:T,onChange:e=>O(e.target.value),className:"w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-800 placeholder-gray-400",placeholder:"Enter table number (1–30)",min:"1",max:"30"})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===X.length?(0,r.jsx)("p",{className:"text-center text-gray-500",children:"No pending orders."}):X.map(e=>{var t;return(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("p",{className:"text-lg font-semibold",children:["Order #",e.order_number||e.id]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Table ",(null===(t=e.tables)||void 0===t?void 0:t.number)||e.table_id]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Placed on ",I(e.created_at)]}),e.notes&&(0,r.jsxs)("p",{className:"text-sm text-gray-700 mt-2",children:[(0,r.jsx)("strong",{children:"Note:"})," ",e.notes]})]}),(0,r.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Items"}),(0,r.jsx)("ul",{className:"mb-4",children:e.items.map((e,t)=>(0,r.jsxs)("li",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:[e.name," ",e.quantity>1?"x".concat(e.quantity):""," ",e.note&&"(".concat(e.note,")")]}),(0,r.jsxs)("span",{children:["₹",(e.price*(e.quantity||1)).toFixed(2)]})]},t))}),(0,r.jsxs)("p",{className:"font-semibold",children:["Total: ₹",e.items.reduce((e,t)=>e+t.price*(t.quantity||1),0).toFixed(2)]}),(0,r.jsx)("button",{className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:()=>J(e),"aria-label":"Edit order ".concat(e.order_number||e.id),children:"Edit Order"})]},e.id)})})]})}),(0,r.jsx)(n.Z,{cart:u,setCart:b,onPlaceOrder:E?R:G,onClose:()=>{j(!1),E&&(q(null),b([]),m(""),g(""))},isOpen:N,tableNumber:a,orderNote:h,isEditing:!!E,menu:F||[]})]})}}},function(e){e.O(0,[913,491,888,774,179],function(){return e(e.s=8186)}),_N_E=e.O()}]);