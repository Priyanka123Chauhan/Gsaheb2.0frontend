(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{1478:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/table/[id]",function(){return a(1959)}])},9292:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(5893),l=a(7294),s=a(9959),o=a(2424),n=a(6979),i=a(3681),c=a(3903);function d(e){let{cart:t,setCart:a,onPlaceOrder:d,onClose:m,isOpen:u,tableNumber:g,orderNote:h,isEditing:x,menu:p}=e,[b,f]=(0,l.useState)(u),[y,N]=(0,l.useState)(!1),[j,w]=(0,l.useState)(t.reduce((e,t)=>(e[t.item_id]=t.note||"",e),{})),[v,I]=(0,l.useState)(""),[C,_]=(0,l.useState)(null);(0,l.useEffect)(()=>{console.log("BottomCart props:",{isEditing:x,menuLength:null==p?void 0:p.length,searchTerm:v,selectedItem:C,isOpen:u,cartLength:t.length})},[x,p,v,C,u,t]),(0,l.useEffect)(()=>{u?(f(!0),N(!1)):(N(!1),setTimeout(()=>f(!1),300))},[u]),(0,l.useEffect)(()=>{w(e=>{let a={...e};return t.forEach(e=>{e.item_id in a||(a[e.item_id]=e.note||"")}),a})},[t]);let S=(e,t)=>{a(a=>{let r=[...a],l=r.findIndex(t=>t.item_id===e);if(-1===l)return a;let s=(r[l].quantity||1)+t;return s<=0?r.filter((e,t)=>t!==l):(r[l]={...r[l],quantity:s},r)})},O=e=>{a(t=>t.filter(t=>t.item_id!==e)),w(t=>{let a={...t};return delete a[e],a})},k=(e,t)=>{w(a=>({...a,[e]:t})),a(a=>a.map(a=>a.item_id===e?{...a,note:t}:a))},E=p?p.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())):[],P=t.reduce((e,t)=>e+t.price*(t.quantity||1),0),q=t.reduce((e,t)=>e+(t.quantity||1),0);return(0,r.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 bg-white shadow-lg rounded-t-2xl transition-transform duration-300 ease-in-out z-50 ".concat(b?y?"translate-y-[calc(100%-3rem)]":"translate-y-0":"translate-y-full"," ").concat(y?"h-12":"max-h-[80vh]"," flex flex-col overflow-hidden"),role:"dialog","aria-modal":"true","aria-label":"Cart contents",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold",children:[x?"Edit Order":"Cart"," - Table ",g||"Not set"]}),q>0&&(0,r.jsxs)("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:[q," ",1===q?"item":"items"]})]}),(0,r.jsx)("button",{className:"text-gray-600 hover:text-gray-800",onClick:t.length>0?()=>{N(!y)}:m,"aria-label":y?"Maximize cart":"Minimize cart",children:t.length>0&&y?(0,r.jsx)(s.Z,{className:"h-6 w-6"}):(0,r.jsx)(o.Z,{className:"h-6 w-6"})})]}),!y&&(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[0===t.length?(0,r.jsx)("p",{className:"text-center text-gray-500",children:"Cart is empty"}):t.map((e,t)=>(0,r.jsxs)("div",{className:"flex flex-col mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("img",{src:e.image_url||"https://images.unsplash.com/photo-1550547660-d9450f859349",alt:e.name,className:"w-16 h-16 object-cover rounded"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.category}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:["₹",(e.price*(e.quantity||1)).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{className:"p-1 bg-gray-200 rounded hover:bg-gray-300",onClick:()=>S(e.item_id,-1),"aria-label":"Decrease quantity of ".concat(e.name),children:(0,r.jsx)(n.Z,{className:"h-4 w-4"})}),(0,r.jsx)("span",{className:"w-8 text-center",children:e.quantity||1}),(0,r.jsx)("button",{className:"p-1 bg-gray-200 rounded hover:bg-gray-300",onClick:()=>S(e.item_id,1),"aria-label":"Increase quantity of ".concat(e.name),children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})}),(0,r.jsx)("button",{className:"p-1 bg-red-100 rounded hover:bg-red-200",onClick:()=>O(e.item_id),"aria-label":"Remove ".concat(e.name," from cart"),children:(0,r.jsx)(c.Z,{className:"h-4 w-4 text-red-600"})})]})]}),(0,r.jsx)("input",{type:"text",value:j[e.item_id]||"",onChange:t=>k(e.item_id,t.target.value),className:"mt-2 w-full p-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Item note (e.g., No cheese)"})]},"".concat(e.item_id,"-").concat(t))),x&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("label",{htmlFor:"item-search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Add New Item"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",id:"item-search",value:v,onChange:e=>{console.log("Search input changed:",{value:e.target.value,filteredItems:E.length}),I(e.target.value),_(null)},className:"w-full p-2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Search menu items..."}),v&&E.length>0&&(0,r.jsx)("ul",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mb-1 max-h-40 overflow-y-auto shadow-lg bottom-full",children:E.map(e=>(0,r.jsxs)("li",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",onClick:()=>{console.log("Dropdown item clicked:",e),_(e),I(e.name)},children:[e.name," - ₹",e.price.toFixed(2)]},e.id))}),v&&0===E.length&&(0,r.jsx)("p",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mb-1 p-2 text-gray-500",children:"No matching items found"})]}),(0,r.jsx)("button",{onClick:()=>{console.log("addItemToCart called:",{selectedItem:C,searchTerm:v}),C&&(a(e=>e.find(e=>e.item_id===C.id)?e.map(e=>e.item_id===C.id?{...e,quantity:(e.quantity||1)+1}:e):[...e,{item_id:C.id,name:C.name,price:C.price,category:C.category,image_url:C.image_url||"",quantity:1,note:""}]),I(""),_(null))},disabled:!C,className:"mt-2 w-full py-2 rounded-lg text-white font-medium ".concat(C?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 cursor-not-allowed"),children:"Add Item"})]})]}),!y&&t.length>0&&(0,r.jsxs)("div",{className:"p-4 border-t",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Total:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["₹",P.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600",onClick:m,"aria-label":"Close cart",children:"Close"}),(0,r.jsx)("button",{className:"flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600",onClick:d,"aria-label":x?"Save Order Changes":"Place Order",children:x?"Save Order Changes":"Place Order"})]})]})]})}},1046:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(8967).eI)("https://oeqdlqmlhclxeelqevlc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9lcWRscW1saGNseGVlbHFldmxjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2NTQ2MTEsImV4cCI6MjA2NjIzMDYxMX0.zeTHfg41DFcGlNLPruysavXOsKHgtr5Uby-f730UWVs")},1959:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var r=a(5893),l=a(7294),s=a(1163),o=a(1535),n=a(1046),i=a(9292);let c=l.forwardRef(function(e,t){let{title:a,titleId:r,...s}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),a?l.createElement("title",{id:r},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"}))});var d=a(8939);let m=e=>fetch(e).then(e=>e.json());function u(){let e=(0,s.useRouter)(),{id:t}=e.query,[a,u]=(0,l.useState)([]),[g,h]=(0,l.useState)(!1),[x,p]=(0,l.useState)(null),[b,f]=(0,l.useState)("All"),[y,N]=(0,l.useState)(!1),[j,w]=(0,l.useState)(null),[v,I]=(0,l.useState)({});(0,l.useEffect)(()=>{localStorage.removeItem("orderId"),localStorage.removeItem("appendOrder"),async function(){if(t)try{let{data:a,error:r}=await n.O.from("orders").select("id, status").eq("table_id",parseInt(t)).eq("status","pending").order("created_at",{ascending:!1}).limit(1);if(r)throw console.error("Error checking orders:",r.message),r;if(console.log("Pending orders found for table",t,":",a),a.length>0){let t=a[0];console.log("Pending order found, redirecting to /order/",t.id),localStorage.setItem("orderId",t.id),e.replace("/order/".concat(t.id))}else console.log("No pending orders found for table",t,", allowing menu access")}catch(e){console.error("Error checking table orders:",e.message)}}()},[t,e]),(0,l.useEffect)(()=>{let e=localStorage.getItem("appendOrder");if(e){let{orderId:t,items:a}=JSON.parse(e);u(a),h(!0),p(t)}},[]);let C="https://backend-valtri.onrender.com/".replace(/\/+$/,""),{data:_,error:S,isLoading:O}=(0,o.ZP)("".concat(C,"/api/menu"),m),k=["All",...new Set(null==_?void 0:_.map(e=>e.category).filter(Boolean))],E="All"===b?_:null==_?void 0:_.filter(e=>e.category===b);(0,l.useEffect)(()=>{S&&w("Failed to load menu. Please try again.")},[S]);let P=e=>{I(t=>({...t,[e.id]:!0})),setTimeout(()=>{I(t=>({...t,[e.id]:!1}))},1e3),u(t=>t.find(t=>t.item_id===e.id)?t.map(t=>t.item_id===e.id?{...t,quantity:(t.quantity||1)+1}:t):[...t,{item_id:e.id,name:e.name,price:e.price,category:e.category,image_url:e.image_url,quantity:1}]),N(!0),console.log("Analytics - Item added:",{item_id:e.id,name:e.name,timestamp:new Date().toISOString()})},q=async()=>{if(0===a.length)return alert("Cart is empty");try{w(null),console.log("PlaceOrder - API URL:",C),console.log("PlaceOrder - Payload:",JSON.stringify({table_id:parseInt(t),items:a}));let r=await fetch("".concat(C,"/api/orders"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_id:parseInt(t),items:a}),signal:AbortSignal.timeout(3e4)});console.log("PlaceOrder - Response status:",r.status);let l=await r.json();if(!r.ok||!l.id)throw Error(l.error||"HTTP ".concat(r.status));localStorage.setItem("orderId",l.id),u([]),N(!1),e.replace("/order/".concat(l.id))}catch(e){console.error("PlaceOrder error:",e.message),w("Failed to place order: ".concat(e.message))}},T=async()=>{if(0===a.length)return alert("Cart is empty");try{w(null),console.log("UpdateOrder - API URL:","".concat(C,"/api/orders/").concat(x)),console.log("UpdateOrder - Payload:",JSON.stringify({items:a}));let t=await fetch("".concat(C,"/api/orders/").concat(x),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:a}),signal:AbortSignal.timeout(3e4)});console.log("UpdateOrder - Response status:",t.status);let r=await t.json();if(!t.ok||!r.id)throw Error(r.error||"HTTP ".concat(t.status));localStorage.removeItem("appendOrder"),h(!1),p(null),localStorage.setItem("orderId",r.id),u([]),N(!1),e.replace("/order/".concat(r.id))}catch(e){console.error("UpdateOrder error:",e.message),w("Failed to update order: ".concat(e.message))}};return O?(0,r.jsx)("div",{className:"text-center mt-10",role:"status",children:"Loading menu..."}):j?(0,r.jsx)("div",{className:"text-center mt-10 text-red-500",role:"alert",children:j}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4 relative",children:[a.length>0&&(0,r.jsxs)("button",{className:"fixed top-4 right-4 bg-blue-500 text-white p-2 rounded-full shadow-lg hover:bg-blue-600 z-50",onClick:()=>{N(e=>!e)},"aria-label":"Toggle cart",children:[(0,r.jsx)(c,{className:"h-6 w-6"}),(0,r.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:a.reduce((e,t)=>e+(t.quantity||1),0)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-6",children:[(0,r.jsx)(d.Z,{className:"h-6 w-6 text-blue-500"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800","aria-label":"Welcome to Gsaheb Cafe",children:"Welcome to Valtri Labs Cafe"}),(0,r.jsx)(d.Z,{className:"h-6 w-6 text-blue-500"})]}),(0,r.jsx)("div",{className:"mb-6 overflow-x-auto whitespace-nowrap pb-2",role:"tablist","aria-label":"Menu categories",children:(0,r.jsx)("div",{className:"flex gap-2",children:k.map(e=>(0,r.jsx)("button",{className:"px-4 py-2 rounded-lg text-sm font-medium ".concat(b===e?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>f(e),role:"tab","aria-selected":b===e,"aria-controls":"menu-items",children:e},e))})}),(0,r.jsx)("div",{id:"menu-items",className:"grid grid-cols-2 md:grid-cols-3 gap-4",role:"region","aria-live":"polite",children:(null==E?void 0:E.length)===0?(0,r.jsx)("p",{className:"col-span-full text-center text-gray-500",children:"No items in this category."}):E.map(e=>(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow",children:[(0,r.jsx)("img",{src:e.image_url||"https://images.unsplash.com/photo-1550547660-d9450f859349",alt:e.name,className:"w-full h-32 object-cover rounded-md mb-2"}),(0,r.jsx)("h2",{className:"font-semibold text-lg",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.category}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:["₹",e.price.toFixed(2)]}),(0,r.jsx)("button",{className:"mt-2 w-full py-2 rounded-lg text-white transition-colors duration-300 ".concat(v[e.id]?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"),onClick:()=>P(e),"aria-label":v[e.id]?"".concat(e.name," added to cart"):"Add ".concat(e.name," to cart"),children:v[e.id]?"Added":"Add to Cart"})]},e.id))}),(0,r.jsx)(i.Z,{cart:a,setCart:u,onPlaceOrder:g?T:q,onClose:()=>N(!1),isOpen:y})]})}}},function(e){e.O(0,[234,491,888,774,179],function(){return e(e.s=1478)}),_N_E=e.O()}]);